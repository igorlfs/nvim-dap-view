<!doctype html>
<html lang="en">

<head>
	<meta charset="utf-8" />
	<link rel="icon" href="https://fav.farm/üòé" />
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	
		<link href="./_app/immutable/assets/0.CY-wNcS-.css" rel="stylesheet">
		<link rel="modulepreload" href="./_app/immutable/entry/start.BSTjOFIo.js">
		<link rel="modulepreload" href="./_app/immutable/chunks/BFvg6U5t.js">
		<link rel="modulepreload" href="./_app/immutable/chunks/Bg0Y8X25.js">
		<link rel="modulepreload" href="./_app/immutable/chunks/CjpeB9No.js">
		<link rel="modulepreload" href="./_app/immutable/chunks/DPEja5KE.js">
		<link rel="modulepreload" href="./_app/immutable/chunks/CYgJF_JY.js">
		<link rel="modulepreload" href="./_app/immutable/chunks/DFAO5y1m.js">
		<link rel="modulepreload" href="./_app/immutable/entry/app.7Y7RhZ5I.js">
		<link rel="modulepreload" href="./_app/immutable/chunks/DNMWFP0k.js">
		<link rel="modulepreload" href="./_app/immutable/chunks/Dic1KHAO.js">
		<link rel="modulepreload" href="./_app/immutable/chunks/BVYR4rSG.js">
		<link rel="modulepreload" href="./_app/immutable/chunks/D149APHh.js">
		<link rel="modulepreload" href="./_app/immutable/nodes/0.DsIH6arH.js">
		<link rel="modulepreload" href="./_app/immutable/chunks/DaVKATEZ.js">
		<link rel="modulepreload" href="./_app/immutable/chunks/DD6pV2wQ.js">
		<link rel="modulepreload" href="./_app/immutable/chunks/DhbAx3b5.js">
		<link rel="modulepreload" href="./_app/immutable/nodes/3.dg64N9pJ.js">
		<link rel="modulepreload" href="./_app/immutable/chunks/D2VCOvFc.js"><!--[--><meta property="og:type" content="article"> <meta property="og:title" content="Building and Debugging C++ in Neovim"><!--]--><title>Building and Debugging C++ in Neovim</title>
</head>

<body data-sveltekit-preload-data="hover" class="bg-base">
	<div style="display: contents"><!--[--><!--[--><!----><div class="flex flex-col min-h-screen justify-between"><div><nav class="bg-crust p-2"><div class="flex justify-between xl:px-36 sm:px-16 px-4 items-center min-h-10"><a class="text-xl text-accent" href="./">IgorLFS</a> <ul><!--[--><li class="gap-5 uppercase"><a href="./about" title="About">About</a></li><!--]--></ul></div></nav><!----> <main><!----><div class="text-text pb-8 my-10 flex justify-center"><article class="xl:w-[60%] w-[90%]"><hgroup><h1 class="capitalize sm:text-5xl text-3xl font-bold text-primary">Building and Debugging C++ in Neovim</h1> <!--[--><p class="mt-2 text-subtext">May 19, 2024</p><!--]--></hgroup> <div class="flex gap-4 mt-3"><!--[--><span class="rounded-3xl bg-crust px-3 py-2">#neovim</span><span class="rounded-3xl bg-crust px-3 py-2">#software</span><!--]--></div> <div class="prose lg:prose-xl max-w-none"><!----><p>Configuring neovim for C++ (and C) can be a bit tricky, especially when it comes to debugging. Fear not! This guide will cover everything you need to know, provided that you have some basic knowledge with plugin installation.</p> <img src="./images/neovim/cpp-dbg.png" alt="Preview" loading="lazy"><!----> <h3 id="goal"><a href="#goal">Goal</a></h3> <p>Of course, we want a powerful debugging experience within neovim. But besides that, this guide differs from others in the sense that its goal is to make the experience as smooth as possible. For instance, it‚Äôs very likely that you‚Äôre not coding by yourself. Since most of your colleagues are using vscode, it would be interesting to leverage vscode‚Äôs build-and-debug scripts that your projects might already have. So, our major goal is to <strong>integrate with already existing building and debugging workflows from vscode</strong>.</p> <h2 id="debugging"><a href="#debugging">Debugging</a></h2> <p>Neovim doesn‚Äôt bundle a debugger by itself[^1]. To enable a powerful debugger, we have to use plugins, and our choice is <a href="https://github.com/mfussenegger/nvim-dap" rel="nofollow">nvim-dap</a>. But before we dive deep into the configuration itself, let‚Äôs understand how debugging works (hint: it‚Äôs not magic!). To debug your program, you‚Äôll need another program, a debugger. Fantastic. But you don‚Äôt want to interact with the debugger directly, you want to debug within your editor! So there must be another program to bridge this gap and handle the communication between the editor and the debugger.</p> <p>But it would really suck if every debugger had to have a different integration for each editor. A little company called Microsoft also noticed that, and established a protocol ‚Äî the Debug Adapter Protocol ‚Äî to standardize how an editor should communicate with a debugger. This communication happens between an editor and a debug adapter, which is usually its own program, but it can be built-in into the debugger. In layman terms, the editor asks a question to the debug adapter using the DAP, and the adapter forwards the question to the debugger, which then responds back to the adapter and, finally, the adapter forwards the response to the editor.</p> <p>Naturally, <code>nvim-dap</code> teaches neovim how to ‚Äúspeak‚Äù DAP.</p> <p>At first, it sounds overcomplicated. Why would we need a debug adapter? Wouldn‚Äôt it be better if the debugger handled the DAP directly? My theory is that having the adapter as a separate program made it easier to spread the adoption of DAP, since developers could turn any already existing debugger into a DAP compliant debugger by ‚Äújust‚Äù handling the communication, without having to rewrite the debugger from scratch. But nowadays, more and more debuggers are implementing the DAP directly, without the need for an adapter as a separate program.</p> <p>With that out of the way, let‚Äôs choose an adapter and a debugger.</p> <h3 id="adapter"><a href="#adapter">Adapter</a></h3> <p>There are two popular debuggers for C++: <a href="https://www.sourceware.org/gdb/" rel="nofollow">gdb</a> and <a href="https://lldb.llvm.org/" rel="nofollow">lldb</a>. Both[^2] ‚Äúcut‚Äù the middle man and implement the DAP directly, which is nice. However, in my opinion, <a href="https://github.com/vadimcn/codelldb" rel="nofollow">codelldb</a> provides the best experience. The naming could use some work, but <code>codelldb</code> is an adapter built on top of <code>lldb</code>. The main advantage of <code>codelldb</code> is that it supports <a href="https://github.com/vadimcn/codelldb/blob/master/MANUAL.md#stdio-redirection" rel="nofollow">stdio redirection</a>, which makes it a breeze to debug competitive programming problems (my main use case). It also isn‚Äôt as verbose with type information as <code>lldb</code> itself. Meanwhile, <code>gdb</code>‚Äôs adapter is in it‚Äôs early stages and has some known <a href="https://www.reddit.com/r/neovim/comments/1aub6fr/gdb_with_nvimdapui_getting_input_from_program/" rel="nofollow">limitations</a>.</p> <h4 id="setup"><a href="#setup">Setup</a></h4> <p>Configuring <code>nvim-dap</code> is a little different than your average neovim lua plugin: there‚Äôs no <code>setup</code> function. Instead, you‚Äôll just define your adapters, keymaps and ‚Äúconfigurations‚Äù (to actually start the debugging process). If you‚Äôre on Linux and <code>codelldb</code> is in your <code>$PATH</code>, you can define the adapter as</p> <!----><pre class="shiki catppuccin-mocha" style="background-color:#1e1e2e;color:#cdd6f4" tabindex="0"><code><span class="line"><span style="color:#89B4FA;font-style:italic">require</span><span style="color:#CDD6F4">(</span><span style="color:#A6E3A1">"dap"</span><span style="color:#CDD6F4">).adapters.codelldb </span><span style="color:#94E2D5">=</span><span style="color:#CDD6F4"> &#123;</span></span>
<span class="line"><span style="color:#CDD6F4"> type </span><span style="color:#94E2D5">=</span><span style="color:#A6E3A1"> "server"</span><span style="color:#CDD6F4">,</span></span>
<span class="line"><span style="color:#CDD6F4"> port </span><span style="color:#94E2D5">=</span><span style="color:#A6E3A1"> "$&#123;port&#125;"</span><span style="color:#CDD6F4">,</span></span>
<span class="line"><span style="color:#CDD6F4"> executable </span><span style="color:#94E2D5">=</span><span style="color:#CDD6F4"> &#123;</span></span>
<span class="line"><span style="color:#CDD6F4">  command </span><span style="color:#94E2D5">=</span><span style="color:#A6E3A1"> "codelldb"</span><span style="color:#CDD6F4">,</span></span>
<span class="line"><span style="color:#CDD6F4">  args </span><span style="color:#94E2D5">=</span><span style="color:#CDD6F4"> &#123; </span><span style="color:#A6E3A1">"--port"</span><span style="color:#CDD6F4">, </span><span style="color:#A6E3A1">"$&#123;port&#125;" </span><span style="color:#CDD6F4">&#125;,</span></span>
<span class="line"><span style="color:#CDD6F4"> &#125;,</span></span>
<span class="line"><span style="color:#CDD6F4">&#125;</span></span></code></pre><!----> <p>Check the <a href="https://github.com/mfussenegger/nvim-dap/wiki/C-C---Rust-(via--codelldb)#start-codelldb-automatically" rel="nofollow">wiki</a> if you‚Äôre using another OS. You can use <a href="https://github.com/williamboman/mason.nvim" rel="nofollow">mason.nvim</a> to handle the installation.</p> <h3 id="configurations"><a href="#configurations">Configurations</a></h3> <p>If you thought we were done configuring, we‚Äôre just getting started! Seriously. The next step is to create a configuration to launch the program we want to debug, thus finishing the chain <code>editor &lt;-> adapter &lt;-> debugger &lt;-> your code</code>. Similarly to how we defined our adapter, we could define a configuration for C++ ‚Äî that‚Äôs what most people do. But that has several limitations. For instance, if you are working with multiple projects, it would certainly be a pain to switch configurations all the time when switching projects. There are workarounds for this situation ‚Äî you could have project local configurations using <code>:h exrc</code>. But then, if you wanna change anything in your local config, you‚Äôd have to source your file again and so on‚Ä¶ That‚Äôs definitely not that smooth!</p> <p>Fortunately, we can do better! In vscode, there‚Äôs a <code>launch.json</code> file which contains the current project‚Äôs debugging configurations. And it just so happens that we can use <code>nvim-dap</code> to source this file (see <code>:h dap.ext.vscode.load_launchjs</code> for details). In fact, in recent versions of nvim-dap, this happens automatically!</p> <p>We‚Äôre almost done! Now it‚Äôd be a good time to add some mappings. You can use my <a href="https://github.com/igorlfs/dotfiles/blob/main/nvim/.config/nvim/lua/plugins/nvim-dap.lua" rel="nofollow">config</a> as a reference.</p> <h2 id="building"><a href="#building">Building</a></h2> <p>It may sound odd to start this guide with the debugging section. An integration that just builds the project sounds way easier. And while that‚Äôs true, the beauty of our setup is that we can integrate the build process inside a debugging configuration. Here‚Äôs how it works: there‚Äôs a field inside the configuration called <code>preLaunchTask</code> that runs a vscode task (defined in a <code>tasks.json</code> file) before the program is started. That‚Äôs just perfect for defining a task to build our projects!</p> <p>If you‚Äôre unfamiliar with these files, don‚Äôt worry, the next section has some examples!</p> <p>Back to the neovim configuration itself, to run the <code>preLaunchTask</code>, we need yet another plugin: <a href="https://github.com/stevearc/overseer.nvim" rel="nofollow">overseer</a>. The configuration is simple, just call the setup function (or use <code>lazy.nvim</code>‚Äôs <code>config</code> property) and you‚Äôre good to go!</p> <h3 id="examples"><a href="#examples">Examples</a></h3> <p>Here‚Äôs a sample <code>launch.json</code>:</p> <!----><pre class="shiki catppuccin-mocha" style="background-color:#1e1e2e;color:#cdd6f4" tabindex="0"><code><span class="line"><span style="color:#9399B2">&#123;</span></span>
<span class="line"><span style="color:#9399B2">    "</span><span style="color:#89B4FA">version</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#A6E3A1"> "0.2.0"</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#9399B2">    "</span><span style="color:#89B4FA">configurations</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#9399B2"> [</span></span>
<span class="line"><span style="color:#9399B2">        &#123;</span></span>
<span class="line"><span style="color:#9399B2">            "</span><span style="color:#89B4FA">type</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#A6E3A1"> "codelldb"</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#9399B2">            "</span><span style="color:#89B4FA">request</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#A6E3A1"> "launch"</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#9399B2">            "</span><span style="color:#89B4FA">name</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#A6E3A1"> "C++"</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#9399B2">            "</span><span style="color:#89B4FA">stdio</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#9399B2"> [</span></span>
<span class="line"><span style="color:#A6E3A1">                "input.txt"</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#FAB387">                null</span></span>
<span class="line"><span style="color:#9399B2">            ],</span></span>
<span class="line"><span style="color:#9399B2">            "</span><span style="color:#89B4FA">preLaunchTask</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#A6E3A1"> "Compile"</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#9399B2">            "</span><span style="color:#89B4FA">postDebugTask</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#A6E3A1"> "Clean"</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#9399B2">            "</span><span style="color:#89B4FA">expressions</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#A6E3A1"> "native"</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#9399B2">            "</span><span style="color:#89B4FA">program</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#A6E3A1"> "$&#123;workspaceFolder&#125;/$&#123;fileBasenameNoExtension&#125;"</span></span>
<span class="line"><span style="color:#9399B2">        &#125;</span></span>
<span class="line"><span style="color:#9399B2">    ]</span></span>
<span class="line"><span style="color:#9399B2">&#125;</span></span></code></pre><!----> <p>And a corresponding <code>tasks.json</code>:</p> <!----><pre class="shiki catppuccin-mocha" style="background-color:#1e1e2e;color:#cdd6f4" tabindex="0"><code><span class="line"><span style="color:#9399B2">&#123;</span></span>
<span class="line"><span style="color:#9399B2">    "</span><span style="color:#89B4FA">version</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#A6E3A1"> "2.0.0"</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#9399B2">    "</span><span style="color:#89B4FA">tasks</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#9399B2"> [</span></span>
<span class="line"><span style="color:#9399B2">        &#123;</span></span>
<span class="line"><span style="color:#9399B2">            "</span><span style="color:#89B4FA">label</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#A6E3A1"> "Compile"</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#9399B2">            "</span><span style="color:#89B4FA">type</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#A6E3A1"> "shell"</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#9399B2">            "</span><span style="color:#89B4FA">command</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#A6E3A1"> "clang++ -std=c++20 -glldb -fstandalone-debug $&#123;relativeFile&#125; -o $&#123;fileBasenameNoExtension&#125;"</span></span>
<span class="line"><span style="color:#9399B2">        &#125;,</span></span>
<span class="line"><span style="color:#9399B2">        &#123;</span></span>
<span class="line"><span style="color:#9399B2">            "</span><span style="color:#89B4FA">label</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#A6E3A1"> "Compile G++"</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#9399B2">            "</span><span style="color:#89B4FA">type</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#A6E3A1"> "shell"</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#9399B2">            "</span><span style="color:#89B4FA">command</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#A6E3A1"> "g++ -ggdb $&#123;relativeFile&#125; -o $&#123;fileBasenameNoExtension&#125;"</span></span>
<span class="line"><span style="color:#9399B2">        &#125;,</span></span>
<span class="line"><span style="color:#9399B2">        &#123;</span></span>
<span class="line"><span style="color:#9399B2">            "</span><span style="color:#89B4FA">label</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#A6E3A1"> "Clean"</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#9399B2">            "</span><span style="color:#89B4FA">type</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#A6E3A1"> "shell"</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#9399B2">            "</span><span style="color:#89B4FA">command</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#A6E3A1"> "rm $&#123;fileBasenameNoExtension&#125;"</span></span>
<span class="line"><span style="color:#9399B2">        &#125;</span></span>
<span class="line"><span style="color:#9399B2">    ]</span></span>
<span class="line"><span style="color:#9399B2">&#125;</span></span></code></pre><!----> <h2 id="feeling-fancy"><a href="#feeling-fancy">Feeling Fancy?</a></h2> <p>If you‚Äôre following along, you might have noticed that currently, your setup doesn‚Äôt look quite as fancy as the screenshot from the beginning. That‚Äôs because it uses two other plugins: <a href="https://github.com/rcarriga/nvim-dap-ui" rel="nofollow">nvim-dap-ui</a> and <a href="https://github.com/theHamsta/nvim-dap-virtual-text" rel="nofollow">nvim-dap-virtual-text</a>. <code>nvim-dap-ui</code> creates the panels on the left side and it‚Äôs somewhat inspired by vscode‚Äôs debug UI. <code>nvim-dap-virtual-text</code>, on the other hand, displays the variables‚Äô values besides their definitions. I don‚Äôt enable it by default, as it can get really noisy, but sometimes it‚Äôs nice to have.</p> <p>Feel free to take a look at my <a href="https://github.com/igorlfs/dotfiles/blob/main/nvim/.config/nvim/lua/plugins/nvim-dap.lua" rel="nofollow">configuration</a>.</p> <p>That‚Äôs all, folks! Thanks for reading!</p> <p>[^1]: It actually does, but it isn‚Äôt a DAP client, so it‚Äôs very limited in what it supports (though it should be good enough for C++). See <code>:h terminal-debug</code> [^2]: Requires a recent version of <code>gdb</code></p><!----><!----></div></article></div><!----><!----></main></div> <nav class="bg-mantle min-h-4 p-2"><ul class="text-subtext text-sm flex justify-center gap-2"><li><a href="https://github.com/igorlfs" target="_blank">GitHub</a></li> <li><a href="mailto:igorlfs@ufmg.com" target="_blank">Contact</a></li></ul></nav><!----></div><!----><!--]--> <!--[!--><!--]--><!--]-->
			
			<script>
				{
					__sveltekit_18enfys = {
						base: new URL(".", location).pathname.slice(0, -1),
						assets: "/igorlfs.github.io"
					};

					const element = document.currentScript.parentElement;

					Promise.all([
						import("./_app/immutable/entry/start.BSTjOFIo.js"),
						import("./_app/immutable/entry/app.7Y7RhZ5I.js")
					]).then(([kit, app]) => {
						kit.start(app, element, {
							node_ids: [0, 3],
							data: [null,null],
							form: null,
							error: null
						});
					});
				}
			</script>
		</div>
</body>

</html>
